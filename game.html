<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>V∆∞·ªùn M√†u K·ª≥ Di·ªáu</title>

<style>
body{
    margin:0;
    height:100vh;
    display:flex;
    justify-content:center;
    align-items:center;
    background:linear-gradient(to bottom,#ffe6fa,#c8f7ff);
    font-family:'Comic Sans MS', cursive;
    overflow:hidden;
}

#container{
    width:95%;
    max-width:750px;
    background:white;
    border-radius:25px;
    padding:20px;
    text-align:center;
    box-shadow:0 10px 25px rgba(0,0,0,0.3);
    position:relative;
}

h1{color:#ff4081;margin-top:0;}

.button{
    padding:12px 22px;
    font-size:20px;
    margin:8px;
    border:none;
    border-radius:20px;
    background:#ffd54f;
    cursor:pointer;
}

.big{font-size:55px;}

.color-circle{
    width:70px;
    height:70px;
    border-radius:50%;
    display:inline-block;
    margin:10px;
    cursor:pointer;
    border:3px solid #fff;
}

#rabbit{
    position:absolute;
    bottom:10px;
    left:10px;
    font-size:55px;
    animation:bounce 1s infinite;
}

@keyframes bounce{
    0%,100%{transform:translateY(0);}
    50%{transform:translateY(-20px);}
}

#timer{
    font-size:18px;
    color:#ff0000;
}
</style>
</head>

<body>

<div id="container">

<h1>üåà V∆∞·ªùn M√†u K·ª≥ Di·ªáu üåà</h1>

<div id="startScreen">
<button class="button" onclick="startGame()">B·∫ÆT ƒê·∫¶U</button>
</div>

<div id="gameScreen" style="display:none;">
<div>
üéØ ƒêi·ªÉm: <span id="score">0</span> |
üîÅ L∆∞·ª£t: <span id="round">0</span>/20 |
‚è≥ Th·ªùi gian: <span id="timer">30</span>s |
üèÜ Cao nh·∫•t: <span id="highscore">0</span>
</div>

<div id="game"></div>
<div id="message"></div>
</div>

<div id="rabbit">üê∞</div>

</div>

<audio id="bgMusic" loop>
<source src="https://actions.google.com/sounds/v1/music/music_box.ogg">
</audio>

<script>
let score=0, round=0, maxRounds=20;
let correctAnswer;
let usedQuestions=new Set();
let timerInterval;
let timeLeft=30;

let fruits=[
{icon:"üçé",name:"t√°o"},
{icon:"üçå",name:"chu·ªëi"},
{icon:"üçá",name:"nho"},
{icon:"üçä",name:"cam"},
{icon:"üçì",name:"d√¢u"},
{icon:"üçç",name:"d·ª©a"}
];

let colors=[
{code:"red",name:"ƒë·ªè"},
{code:"blue",name:"xanh d∆∞∆°ng"},
{code:"yellow",name:"v√†ng"},
{code:"green",name:"xanh l√°"},
{code:"purple",name:"t√≠m"},
{code:"orange",name:"cam"},
{code:"pink",name:"h·ªìng"},
{code:"brown",name:"n√¢u"}
];

let highscore=localStorage.getItem("highscore")||0;
document.getElementById("highscore").innerText=highscore;

function startGame(){
document.getElementById("startScreen").style.display="none";
document.getElementById("gameScreen").style.display="block";
document.getElementById("bgMusic").volume=1.0;
document.getElementById("bgMusic").play();
nextRound();
}

function startTimer(){
clearInterval(timerInterval);
timeLeft=30;
document.getElementById("timer").innerText=timeLeft;
timerInterval=setInterval(()=>{
timeLeft--;
document.getElementById("timer").innerText=timeLeft;
if(timeLeft<=0){
clearInterval(timerInterval);
document.getElementById("message").innerText="‚è∞ H·∫øt gi·ªù!";
setTimeout(nextRound,1000);
}
},1000);
}

function updateInfo(){
document.getElementById("score").innerText=score;
document.getElementById("round").innerText=round;
}

function generateUnique(key){
if(usedQuestions.has(key)) return false;
usedQuestions.add(key);
return true;
}

function fruitQuestion(){
let fruit, number, key;
do{
fruit=fruits[Math.floor(Math.random()*fruits.length)];
number=Math.floor(Math.random()*8)+1;
key="fruit-"+fruit.name+"-"+number;
}while(!generateUnique(key));

correctAnswer=number;

let display="";
for(let i=0;i<number;i++) display+=fruit.icon+" ";

let game=document.getElementById("game");
game.innerHTML="<div class='big'>"+display+"</div>";
game.innerHTML+="<p>C√≥ bao nhi√™u qu·∫£ "+fruit.name+"?</p>";

createNumberOptions(number);
}

function colorQuestion(){
let color,key;
do{
color=colors[Math.floor(Math.random()*colors.length)];
key="color-"+color.name;
}while(!generateUnique(key));

correctAnswer=color.code;

let game=document.getElementById("game");
game.innerHTML="<p>H√£y ch·ªçn m√†u "+color.name+"</p>";

let shuffled=[...colors].sort(()=>Math.random()-0.5).slice(0,6);
if(!shuffled.find(c=>c.code===color.code)){
shuffled[0]=color;
}

shuffled.forEach(c=>{
let div=document.createElement("div");
div.className="color-circle";
div.style.backgroundColor=c.code;
div.onclick=()=>checkAnswer(c.code);
game.appendChild(div);
});
}

function createNumberOptions(correct){
let options=[correct];
while(options.length<3){
let n=Math.floor(Math.random()*10)+1;
if(!options.includes(n)) options.push(n);
}
options.sort(()=>Math.random()-0.5);

options.forEach(n=>{
let btn=document.createElement("button");
btn.className="button";
btn.innerText=n;
btn.onclick=()=>checkAnswer(n);
document.getElementById("game").appendChild(btn);
});
}

function checkAnswer(ans){
clearInterval(timerInterval);
if(ans===correctAnswer){
score++;
document.getElementById("message").innerText="üéâ Ch√≠nh x√°c!";
}else{
document.getElementById("message").innerText="üò¢ Sai r·ªìi!";
}
setTimeout(nextRound,1000);
}

function nextRound(){
document.getElementById("message").innerText="";
round++;
if(round>maxRounds){
if(score>highscore){
localStorage.setItem("highscore",score);
}
alert("Ho√†n th√†nh! ƒêi·ªÉm: "+score);
location.reload();
return;
}
updateInfo();
if(Math.random()<0.5) fruitQuestion();
else colorQuestion();
startTimer();
}

updateInfo();
</script>

</body>
</html>